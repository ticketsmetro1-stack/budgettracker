<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget PWA</title>
<style>
:root {
  --bg:#f4f6f8;--card:#fff;--muted:#6b7280;--accent:#2563eb;--radius:12px;--text:#111827;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial
}
[data-theme="dark"] {
  --bg:#0b1220;--card:#0f1724;--muted:#9aa8bf;--accent:#3b82f6;--text:#e6eef8
}
body{margin:0;background:var(--bg);color:var(--text);}
.app{max-width:800px;margin:20px auto;padding:16px}
header{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
h1{font-size:22px;margin:0}
.controls{margin-left:auto;display:flex;gap:6px;flex-wrap:wrap}
button,select{padding:6px 10px;border:none;border-radius:var(--radius);cursor:pointer;font-size:14px}
button{background:var(--accent);color:#fff}
.goal{background:var(--card);padding:12px;border-radius:var(--radius);margin-top:14px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.goal h3{margin:0 0 8px 0}
.progress{background:#ddd;height:10px;border-radius:6px;overflow:hidden;margin:6px 0}
.progress-bar{background:var(--accent);height:100%}
.actions{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
.transactions{margin-top:8px;font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>üí∞ Budget Goals</h1>
    <div class="controls">
      <button onclick="addGoal()">‚ûï Goal</button>
      <select id="currencySelect" onchange="changeCurrency()">
        <option value="EGP">EGP</option>
        <option value="USD">USD</option>
        <option value="SAR">SAR</option>
      </select>
    </div>
  </header>

  <div id="goals"></div>
</div>

<script>
let goals = JSON.parse(localStorage.getItem("goals")) || [];
let currentCurrency = localStorage.getItem("currency") || "USD";

document.getElementById("currencySelect").value = currentCurrency;

function saveGoals(){
  localStorage.setItem("goals", JSON.stringify(goals));
}
function formatCurrency(amount){
  const symbols = { EGP:"¬£", USD:"$", SAR:"Ô∑º" };
  return symbols[currentCurrency]+amount;
}
function changeCurrency(){
  currentCurrency = document.getElementById("currencySelect").value;
  localStorage.setItem("currency", currentCurrency);
  renderGoals();
}
function addGoal(){
  const name = prompt("Goal name:");
  const target = parseFloat(prompt("Target amount:"));
  if(!name || isNaN(target)) return;
  goals.push({id:Date.now(),name,target,saved:0,transactions:[]});
  saveGoals();
  renderGoals();
}
function editGoal(id){
  const g = goals.find(x=>x.id===id);
  if(!g) return;
  const name = prompt("New name:", g.name);
  const target = parseFloat(prompt("New target:", g.target));
  if(!name || isNaN(target)) return;
  g.name=name; g.target=target;
  saveGoals(); renderGoals();
}
function deleteGoal(id){
  if(!confirm("Delete this goal?")) return;
  goals = goals.filter(x=>x.id!==id);
  saveGoals(); renderGoals();
}
function addTransaction(id){
  const g = goals.find(x=>x.id===id);
  if(!g) return;
  const amt = parseFloat(prompt("Amount:"));
  const note = prompt("Note:");
  if(isNaN(amt)) return;
  g.saved += amt;
  g.transactions.push({amount:amt,note,date:new Date().toLocaleDateString()});
  saveGoals(); renderGoals();
}
function renderGoals(){
  const container = document.getElementById("goals");
  container.innerHTML="";
  goals.forEach(g=>{
    const percent = Math.min(100,(g.saved/g.target*100).toFixed(1));
    const div=document.createElement("div");
    div.className="goal";
    div.innerHTML=`
      <h3>${g.name}</h3>
      <p>Target: ${formatCurrency(g.target)}</p>
      <p>Saved: ${formatCurrency(g.saved)} (${percent}%)</p>
      <div class="progress"><div class="progress-bar" style="width:${percent}%"></div></div>
      <div class="actions">
        <button onclick="addTransaction(${g.id})">‚ûï</button>
        <button onclick="editGoal(${g.id})">‚úèÔ∏è</button>
        <button onclick="deleteGoal(${g.id})">üóëÔ∏è</button>
      </div>
      <div class="transactions">
        ${g.transactions.slice(-3).map(t=>`<div>${formatCurrency(t.amount)} - ${t.note||""} (${t.date})</div>`).join("")}
      </div>
    `;
    container.appendChild(div);
  });
}
renderGoals();

// Register service worker
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('sw.js')
      .then(reg=>console.log("SW registered:", reg))
      .catch(err=>console.log("SW failed:", err));
  });
}
</script>
</body>
</html>
