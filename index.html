<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Budget PWA</title>
<style>
:root {
  --bg:#f4f6f8;--card:#fff;--muted:#6b7280;--accent:#2563eb;
  --radius:14px;--gap:14px;--text:#111827;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial
}
[data-theme="dark"] {--bg:#0b1220;--card:#0f1724;--muted:#9aa8bf;--accent:#3b82f6;--text:#e6eef8}
body{margin:0;background:var(--bg);color:var(--text);}
.app{max-width:900px;margin:20px auto;padding:16px}
h1{font-size:22px;margin:0 0 12px 0}

/* Goal cards */
.goal{background:var(--card);padding:14px;border-radius:var(--radius);margin-bottom:var(--gap);box-shadow:0 1px 4px rgba(0,0,0,0.08);}
.goal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.goal-title{font-weight:600;font-size:16px}
.goal-actions{display:flex;gap:8px}
.goal-actions button{background:none;border:none;cursor:pointer;font-size:18px}
.progress{height:10px;background:#ddd;border-radius:10px;overflow:hidden;margin:8px 0}
.progress-bar{height:100%;background:var(--accent)}

/* Inline form */
.inline-form{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.inline-form input,.inline-form select{padding:8px;border-radius:8px;border:1px solid #ccc;font-size:14px}
.btn{background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer}
.btn.secondary{background:#ccc;color:#000}

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center}
.sheet{background:var(--card);padding:20px;border-radius:var(--radius);max-width:360px;width:90%}
.tx-form{display:flex;flex-direction:column;gap:10px;margin:12px 0}
.tx-form label{font-size:13px;color:var(--muted);margin-bottom:-4px}
.tx-form input{padding:8px 10px;border-radius:8px;border:1px solid #ccc;font-size:14px;background:var(--bg);color:var(--text)}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}
</style>
</head>
<body>
<div class="app">
  <h1>My Goals</h1>

  <!-- Add Goal Form -->
  <div class="inline-form">
    <input id="goalName" placeholder="Goal Name" />
    <div style="display:flex;gap:6px;">
      <input id="goalAmount" type="number" placeholder="Amount" />
      <select id="goalCurrency">
        <option value="EGP">EGP</option>
        <option value="USD" selected>USD</option>
        <option value="SAR">SAR</option>
      </select>
    </div>
    <input id="goalTarget" type="number" placeholder="Target (optional)" />
    <input id="dueValue" type="date" />
    <input id="goalColor" type="color" value="#22c55e" />
    <button class="btn" onclick="saveGoal()" id="addGoalBtn">Add Goal</button>
  </div>

  <!-- Goals list -->
  <div id="goalList"></div>
</div>

<!-- Transaction Modal -->
<div id="transactionModal" class="modal">
  <div class="sheet">
    <h3 style="margin-top:0;font-size:18px;font-weight:600;">Add Transaction</h3>
    <div class="tx-form">
      <label>Amount</label>
      <input id="txAmount" type="number" placeholder="Enter amount" />

      <label>Category</label>
      <input id="txCategory" placeholder="e.g. Food, Bills" />

      <label>Date</label>
      <input id="txDate" type="date" />
    </div>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('transactionModal')">Cancel</button>
      <button class="btn" id="confirmTxBtn">Add</button>
    </div>
  </div>
</div>

<script>
let goals = JSON.parse(localStorage.getItem("pwa-goals")||"[]");
let editingGoal=null;
let activeGoal=null;

function saveGoal(){
  const name=document.getElementById('goalName').value.trim();
  const amount=parseFloat(document.getElementById('goalAmount').value)||0;
  const target=parseFloat(document.getElementById('goalTarget').value)||0;
  const due=document.getElementById('dueValue').value;
  const color=document.getElementById('goalColor').value;
  const currency=document.getElementById('goalCurrency').value;

  if(!name){alert("Enter goal name");return;}

  if(editingGoal){
    let g=goals.find(x=>x.id===editingGoal);
    g.name=name;g.amount=amount;g.target=target;g.due=due;g.color=color;g.currency=currency;
    editingGoal=null;
    document.getElementById("addGoalBtn").textContent="Add Goal";
  } else {
    goals.push({id:Date.now().toString(),name,amount,target,due,color,currency,transactions:[]});
  }
  localStorage.setItem("pwa-goals",JSON.stringify(goals));
  renderGoals();
  clearForm();
}
function clearForm(){
  document.getElementById('goalName').value="";
  document.getElementById('goalAmount').value="";
  document.getElementById('goalTarget').value="";
  document.getElementById('dueValue').value="";
}

function renderGoals(){
  const list=document.getElementById("goalList");
  list.innerHTML="";
  goals.forEach(g=>{
    const saved=g.transactions.reduce((a,t)=>a+t.amount,0);
    const percent=g.target?Math.min(100,(saved/g.target*100).toFixed(1)):0;

    const div=document.createElement("div");
    div.className="goal";
    div.innerHTML=`
      <div class="goal-header">
        <span class="goal-title">${g.name}</span>
        <div class="goal-actions">
          <button onclick="addTransaction('${g.id}')">‚ûï</button>
          <button onclick="editGoal('${g.id}')">‚úèÔ∏è</button>
          <button onclick="deleteGoal('${g.id}')">üóë</button>
        </div>
      </div>
      <div>${g.currency} ${saved} / ${g.currency} ${g.target||0}</div>
      <div class="progress"><div class="progress-bar" style="width:${percent}%;background:${g.color}"></div></div>
      <small>${percent}% complete ${g.due?("| Due: "+g.due):""}</small>
    `;
    list.appendChild(div);
  });
}
function editGoal(id){
  const g=goals.find(x=>x.id===id);
  if(!g)return;
  document.getElementById('goalName').value=g.name;
  document.getElementById('goalAmount').value=g.amount;
  document.getElementById('goalTarget').value=g.target;
  document.getElementById('dueValue').value=g.due;
  document.getElementById('goalColor').value=g.color;
  document.getElementById('goalCurrency').value=g.currency;
  editingGoal=id;
  document.getElementById("addGoalBtn").textContent="Update Goal";
}
function deleteGoal(id){
  if(confirm("Delete this goal?")){
    goals=goals.filter(g=>g.id!==id);
    localStorage.setItem("pwa-goals",JSON.stringify(goals));
    renderGoals();
  }
}
function addTransaction(id){
  activeGoal=id;
  document.getElementById("transactionModal").style.display="flex";
}
function closeModal(id){
  document.getElementById(id).style.display="none";
}
document.getElementById("confirmTxBtn").onclick=function(){
  const amt=parseFloat(document.getElementById("txAmount").value)||0;
  const cat=document.getElementById("txCategory").value||"Other";
  const date=document.getElementById("txDate").value||new Date().toISOString().split("T")[0];
  let g=goals.find(x=>x.id===activeGoal);
  if(g){
    g.transactions.push({amount:amt,category:cat,date});
    localStorage.setItem("pwa-goals",JSON.stringify(goals));
    renderGoals();
  }
  closeModal("transactionModal");
};

renderGoals();

// expose for inline
window.saveGoal=saveGoal;
window.editGoal=editGoal;
window.deleteGoal=deleteGoal;
window.addTransaction=addTransaction;
window.closeModal=closeModal;

// Register SW
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{
    navigator.serviceWorker.register('sw.js').then(r=>console.log("SW registered"));
  });
}
</script>
</body>
</html>
